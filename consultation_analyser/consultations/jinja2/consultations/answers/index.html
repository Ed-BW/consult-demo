{% extends "base.html" %}
{%- from 'govuk_frontend_jinja/components/back-link/macro.html' import govukBackLink -%}
{%- from "govuk_frontend_jinja/components/breadcrumbs/macro.html" import govukBreadcrumbs -%}
{%- from 'govuk_frontend_jinja/components/button/macro.html' import govukButton -%}

{% set page_title = "Response explorer" %}

{% block content %}

  <p class="govuk-heading-s">{{ consultation_name }}</p>
  {{ govukBreadcrumbs({
    "items": [
      {
        "text": "Your consultations",
        "href": "/consultations",
      },
      {
        "text": "All questions",
        "href": "/consultations/" + consultation_slug
      }
    ]
  }) }}

  <div class="govuk-grid-row govuk-!-margin-top-5">
    <div class="govuk-grid-column-full">
      <h1 class="govuk-heading-m govuk-!-font-weight-regular">
        <span class="govuk-body-s govuk-!-display-block govuk-!-font-weight-bold">Question {{question.number}}</span>
        {{ question.text }}
      </h1>
      <h2 class="govuk-heading-m govuk-!-font-weight-regular">
        {{ free_text_question_part.text }}
      </h2>
    </div>

    <!-- TODO: add search bar -->
  </div>

  <div class="govuk-grid-row govuk-!-margin-top-5">
    <div class="govuk-grid-column-one-quarter-from-desktop">
      <div class="iai-panel govuk-!-margin-bottom-5">
        <h2 class="govuk-body-s govuk-!-display-block govuk-!-font-weight-bold">Filters</h2>
        READD FILTERS (keywords, theme)
      </div>
    </div>

    <div class="govuk-grid-column-three-quarters-from-desktop">
      <span class="govuk-caption-m">{{ total_responses }} responses</span>
      <h2 class="govuk-heading-m">Overview</h2>
      
      <!-- TODO: add 'top themes' panel here -->

      <!-- TODO: add 'Response to multiple choice' panel here -->

      <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
          <span class="govuk-caption-m">{{ total_responses }} responses</span>
          <h2 class="govuk-heading-m">Individual responses</h2>
        </div>
      </div>

      <!-- TODO: add sorting options here -->
      
      <!-- TODO: replace table below with detailed response panels -->

      {# Responses #}

      {% for respondent in respondents %}
        <div class="iai-panel response govuk-!-margin-bottom-4">
          <div class="govuk-grid-row">
            <div class="govuk-grid-column-two-thirds">
              {% if respondent.individual %}
                <span class="govuk-caption-m">{{ respondent.individual }}</span>
              {% endif %}
              <h2 class="govuk-heading-m">
                <!-- <a href="/respondent/0" class="govuk-link govuk-link--no-underline govuk-link--no-visited-state">
                  Respondent 0
                </a> -->
                Respondent {{ respondent.id }}
              </h2>
            </div>
            <!-- <div class="govuk-grid-column-one-third">
              <a class="pin-response align-right">
                <p class="govuk-body-s govuk-!-margin-bottom-0" style="display: flex; align-items: center;">
                  <img src="/public/images/pin-response.svg" alt="Pin response">
                  <span>Pin response</span>
                </p>
              </a>
            </div> -->
          </div>
            {% if respondent.free_text_answer %}
              <h3 class="govuk-heading-s govuk-!-margin-bottom-4">Free text response</h3>
              {% if respondent.sentiment %}
                <p class="govuk-body" style="display: flex; align-items: center; gap: 0.6%;">
                  <!-- <img src="/public/images/thumbs-up.svg" alt="icon" style="width: 24px; height: 24px;"> -->
                  <span>{{ respondent.sentiment.position }}</span>
                </p>
              {% endif %}

              {% for theme in respondent.themes %}

                <div class="govuk-pill-container" style="display: flex; align-items: center; gap: 0.6%;">
                  <div class="govuk-pill">
                    <tool-tip class="iai-tooltip">
                      <div class="iai-tooltip__button" role="tooltip" tabindex="0" aria-describedby="tooltip-content-2a1c358a-162a-4cf8-8011-43c13ef22785">
                        <!-- <img src="/public/images/tick.svg" alt="icon" style="width: 24px; height: 24px;"> -->
                        <span>{{ theme.theme.name }}</span>
                        <img src="/public/images/question-mark.svg" alt="info" width="14">
                      </div>
                      <div class="iai-tooltip__content" id="tooltip-content-2a1c358a-162a-4cf8-8011-43c13ef22785">
                        {{ theme.theme.description }}
                      </div>
                    </tool-tip>
                  </div>
                </div>
              
              {% endfor %}

              <p class="govuk-body" style="line-height: 2em;">
                {{ respondent.free_text_answer.text }}
              </p>
            {% endif %}

            {% if has_multiple_choice_question_part %}
              <h3 class="govuk-heading-s govuk-!-margin-bottom-2">Response to multiple choice</h3>
              {% if respondent.multiple_choice_answer %}
                <p class="govuk-body" style="line-height: 2em;">
                  {{ respondent.multiple_choice_answer.chosen_options }}
                </p>
              {% else %}
              <p class="govuk-body" style="line-height: 2em;">
                Not answered
              </p>
              {% endif %}
            {% endif %}

          <p class="govuk-body-s">{{ respondent.demographic_data }}</p>
        </div>
      {% endfor %}

      {# Pagination #}
        {% if pagination.paginator.num_pages > 1 %}
          <nav class="govuk-pagination" role="navigation" aria-label="Pagination">

            {% if pagination.number > 1 %}
              <div class="govuk-pagination__prev">
                <a class="govuk-link govuk-pagination__link" href="?page={{ pagination.number - 1 }}" rel="prev">
                  <svg class="govuk-pagination__icon govuk-pagination__icon--prev" xmlns="http://www.w3.org/2000/svg" height="13" width="15" aria-hidden="true" focusable="false" viewBox="0 0 15 13">
                    <path d="m6.5938-0.0078125-6.7266 6.7266 6.7441 6.4062 1.377-1.449-4.1856-3.9768h12.896v-2h-12.984l4.2931-4.293-1.414-1.414z"></path>
                  </svg>
                  <span class="govuk-pagination__link-title">
                    Previous<span class="govuk-visually-hidden"> page</span>
                  </span>
                </a>
              </div>
            {% endif %}

            <ul class="govuk-pagination__list">

              {% if pagination.number > 2 %}
                <li class="govuk-pagination__item">
                  <a class="govuk-link govuk-pagination__link" href="?page=1" aria-label="Page 1">
                    1
                  </a>
                </li>
                <li class="govuk-pagination__item govuk-pagination__item--ellipses">
                  &ctdot;
                </li>
              {% endif %}

              {% if pagination.has_previous() %}
                <li class="govuk-pagination__item">
                  <a class="govuk-link govuk-pagination__link" href="?page={{ pagination.previous_page_number() }}" aria-label="Page {{ pagination.previous_page_number() }}">
                    {{ pagination.previous_page_number() }}
                  </a>
                </li>
              {% endif %}
              <li class="govuk-pagination__item govuk-pagination__item--current">
                <a class="govuk-link govuk-pagination__link" href="?page={{ pagination.number }}" aria-label="Page {{ pagination.number }}" aria-current="page">
                  {{ pagination.number }}
                </a>
              </li>

              {% if pagination.has_next() %}
                <li class="govuk-pagination__item">
                  <a class="govuk-link govuk-pagination__link" href="?page={{ pagination.next_page_number() }}" aria-label="Page {{ pagination.next_page_number() }}">
                    {{ pagination.next_page_number() }}
                  </a>
                </li>
              {% endif %}

              {% if pagination.paginator.num_pages > pagination.number + 1 %}
                <li class="govuk-pagination__item govuk-pagination__item--ellipses">
                  &ctdot;
                </li>
                <li class="govuk-pagination__item">
                  <a class="govuk-link govuk-pagination__link" href="?page={{ pagination.paginator.num_pages }}" aria-label="Page {{ pagination.paginator.num_pages }}">
                    {{ pagination.paginator.num_pages }}
                  </a>
                </li>
              {% endif %}

            </ul>

            {% if pagination.has_next() %}
              <div class="govuk-pagination__next">
                <a class="govuk-link govuk-pagination__link" href="?page={{ pagination.next_page_number() }}" rel="next">
                  <span class="govuk-pagination__link-title">
                    Next<span class="govuk-visually-hidden"> page</span>
                  </span>
                  <svg class="govuk-pagination__icon govuk-pagination__icon--next" xmlns="http://www.w3.org/2000/svg" height="13" width="15" aria-hidden="true" focusable="false" viewBox="0 0 15 13">
                    <path d="m8.107-0.0078125-1.4136 1.414 4.2926 4.293h-12.986v2h12.896l-4.1855 3.9766 1.377 1.4492 6.7441-6.4062-6.7246-6.7266z"></path>
                  </svg>
                </a>
              </div>
            {% endif %}

          </nav>
        {% endif %}

    </div>

  </div>

{% endblock %}
